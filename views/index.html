<!DOCTYPE html>
<html lang="en" ng-app="myApp">

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>ParkWiz</title>
<script async defer
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjFNJakTcBDyGbyNZHQNSpamaxlpWl3c0&libraries=places">
	
</script>

<!-- Bootstrap Core CSS -->
<!-- <link href="/stylesheets/bootstrap.min.css" rel="stylesheet"> -->

<!-- Angular Core javascript -->
<!-- <script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script> -->

<!-- jQuery -->
<!-- <script src="/js/jquery.min.js"></script> -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.0/jquery.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.js"></script>
    <script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-1.3.2.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="/js/MyAccount.js"></script>
<script src="/js/booking.js"></script>


<!--Gauge graph-->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/highcharts-3d.js"></script>
<script src="https://code.highcharts.com/modules/solid-gauge.js"></script>
<!-- MetisMenu CSS -->
<link href="/stylesheets/metisMenu.min.css" rel="stylesheet">

<!-- Timeline CSS -->
<link href="/stylesheets/timeline.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="/stylesheets/sb-admin-2.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="/stylesheets/font-awesome.min.css" rel="stylesheet"
	type="text/css">

<!-- Profile CSS -->
<link href="/stylesheets/profile.css" rel="stylesheet">

<link media="all" type="text/css" rel="stylesheet"
	href="/stylesheets/myaccount.css">
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body ng-controller="layoutmodule">
	<div id="wrapper">
		<!-- Navigation -->
		<nav class="navbar navbar-default navbar-static-top" role="navigation"
			style="margin-bottom: 0; position: fixed; width: 100%;">
			<table id="navtable" width="100%">
				<tr>
					<td><div class="navbar-header" style="display: block;">
							<div class="dropdown" style="float: left;">
								<button class="dropbtn" onclick="toggle(this);">
									<i class="fa fa-home fa-fw menuSize"></i>Menu
								</button>
								<div id="navMenus" class="dropdown-content" style="left: 0;">
									<ul class="nav" id="side-menu">
										<li><a class="aNav" href="/"><p align="center">
													<i class="fa fa fa-bookmark fa-fw menuSize"></i>
												</p>
												<p align="center">Reservation</p></a></li>
										<li><a class="aNav" href="#"><p align="center">
													<i class="fa fa-child fa-fw menuSize"></i>
												</p>
												<p align="center">User Details</p></a></li>
										<li ng-click="billing();"><a class="aNav" href="#"><p
													align="center">
													<i class="fa fa-money fa-fw menuSize"></i>
												</p>
												<p align="center">Billing</p></a></li>
										<li><a class="aNav" href="#"><p align="center">
													<i class="fa fa-dashboard fa-fw menuSize"></i>
												</p>
												<p align="center">Graphs</p></a></li>
										<li ng-click="details();"><a class="aNav" href="#"><p align="center">
													<i class="fa fa-book fa-fw menuSize"></i>
												</p>
												<p align="center">Reviews</p></a></li>
										<li><a class="aNav" href="#"><p
													align="center">
													<i class="fa fa-sitemap fa-fw menuSize"></i>
												</p>
												<p align="center">Multi-Level</p> </span></a></li>
										<li><a class="aNav" href="#"><p align="center">
													<i class="fa fa-bar-chart-o fa-fw menuSize"></i>
												</p>
												<p align="center">Charts</p></a></li>
									</ul>
								</div>
							</div>
							<a class="navbar-brand" href="/">ParkWiz</a>
						</div> <!-- /.navbar-header --></td>
					<td>
						<div style="float: right;">
							<ul id="subdiv" class="nav navbar-top-links navbar-right">
								<!--<li class="dropdown"><a class="dropdown-toggle"
									data-toggle="dropdown" href="#"> <i
										class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
								</a>
									<ul class="dropdown-menu dropdown-tasks">
										<li><a href="#">
												<div>
													<p>
														<strong>Task 1</strong> <span
															class="pull-right text-muted">40% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-success"
															role="progressbar" aria-valuenow="40" aria-valuemin="0"
															aria-valuemax="100" style="width: 40%">
															<span class="sr-only">40% Complete (success)</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<p>
														<strong>Task 2</strong> <span
															class="pull-right text-muted">20% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-info"
															role="progressbar" aria-valuenow="20" aria-valuemin="0"
															aria-valuemax="100" style="width: 20%">
															<span class="sr-only">20% Complete</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<p>
														<strong>Task 3</strong> <span
															class="pull-right text-muted">60% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-warning"
															role="progressbar" aria-valuenow="60" aria-valuemin="0"
															aria-valuemax="100" style="width: 60%">
															<span class="sr-only">60% Complete (warning)</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<p>
														<strong>Task 4</strong> <span
															class="pull-right text-muted">80% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-danger"
															role="progressbar" aria-valuenow="80" aria-valuemin="0"
															aria-valuemax="100" style="width: 80%">
															<span class="sr-only">80% Complete (danger)</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a class="text-center" href="#"> <strong>See
													All Tasks</strong> <i class="fa fa-angle-right"></i>
										</a></li>
									</ul></li> -->
								<!-- /.dropdown -->
								<!--<li class="dropdown"><a class="dropdown-toggle"
									data-toggle="dropdown" href="#"> <i
										class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
								</a>
									<ul class="dropdown-menu dropdown-alerts">
										<li><a href="#">
												<div>
													<i class="fa fa-comment fa-fw"></i> New Comment <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-twitter fa-fw"></i> 3 New Followers <span
														class="pull-right text-muted small">12 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-envelope fa-fw"></i> Message Sent <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-tasks fa-fw"></i> New Task <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-upload fa-fw"></i> Server Rebooted <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a class="text-center" href="#"> <strong>See
													All Alerts</strong> <i class="fa fa-angle-right"></i>
										</a></li>
									</ul></li> -->
								<!-- /.dropdown -->
								<li class="dropdown"><a class="dropdown-toggle"
									data-toggle="dropdown" href="#"> <i
										class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
								</a>
									<ul class="dropdown-menu dropdown-user">
										<li id="myaccount" ng-click="account();"><a href="#"><i
												class="fa fa-user fa-fw"></i> My Account</a></li>
										<li class="divider"></li>
										<li id="bookinghistory" ng-click="bookinghistory();"><a
											href="#"><i class="fa fa-calendar fa-fw"></i> Booking
												History</a></li>
										<li class="divider"></li>
										<li><a href="#"><i class="fa fa-gear fa-fw"></i>
												Settings</a></li>
										<li class="divider"></li>
										<li><a href="login.html"><i
												class="fa fa-sign-out fa-fw"></i> Logout</a></li>
									</ul> <!-- /.dropdown-user --></li>
								<!-- /.dropdown -->
							</ul>
							<!-- /.navbar-top-links -->
						</div>
					</td>
				</tr>
			</table>



		</nav>

		<div id="page-wrapper">
			<div ng-include src="template.url"></div>
			<br />
		</div>
		<!-- /#page-wrapper -->

	</div>
	<!-- /#wrapper -->

	<!-- Bootstrap Core JavaScript -->
	<!-- <script src="/js/bootstrap.min.js"></script> -->

	<!-- Metis Menu Plugin JavaScript -->
	<script src="/js/metisMenu.min.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="/js/sb-admin-2.js"></script>

	
</body>

<script>

	var autocomplete;
	angular.module('myApp', ['ngAnimate','ui.bootstrap']);
	
	angular.module('myApp').controller('layoutmodule', layoutmodule);
	function layoutmodule($scope, $http) {
		var templateName = "Search Page"; // Search is the default url.
		if (typeof (Storage) !== "undefined") {
			templateName = sessionStorage.getItem("template");
			if (!templateName) {
				templateName = "Search Page";
			} else {
				sessionStorage.removeItem("template");
			}
		}

		$scope.addlistings = function() {
			$scope.template = $scope.templates[5];
			$("#navMenus").hide();
		};

		$scope.details = function() {
			$scope.template = $scope.templates[6];
			$("#navMenus").hide();
		}

		$scope.billing = function() {
			$scope.template = $scope.templates[1];
			$("#navMenus").hide();
		};

		$scope.bookinghistory = function() {
			$scope.template = $scope.templates[4];
			$("#navMenus").hide();
		};

		$scope.account = function() {
			$scope.template = $scope.templates[3];
			initializeMyAccount($scope, $http);

			$("#navMenus").hide();
		};

		$scope.templates = [ {
			name : 'Search Page',
			url : '/search',
			initializeFunction : undefined
		}, {
			name : 'My Billing History',
			url : '/billing',
			initializeFunction : undefined
		}, {
			name : 'Billing',
			url : '/payment'
		}, {
			name : 'My Account',
			url : '/profile',
			initializeFunction : initializeMyAccount
		}, {
			name : 'My Booking History',
			url : '/bookings',
			initializeFunction : function($scope, $http) {
				$scope.bookingInfo = [ {
					'location' : 'blah st, San Jose, Ca',
					'from' : '01/01/2016',
					'to' : '01/03/2016',
					'status' : 'Completed'
				}, {
					'location' : 'blah st, San Jose, Ca',
					'from' : '02/01/2016',
					'to' : '02/03/2016',
					'status' : 'Pending'
				}, {
					'location' : 'blah st, San Jose, Ca',
					'from' : '04/01/2015',
					'to' : '04/03/2015',
					'status' : 'Completed'
				} ];
			}
		}, {
			name : 'AddListing',
			url : '/addlisting'
		}, {
			name : 'Details',
			url : '/details'
		} ];

		$scope.templates.forEach(function(template) {
			if (template['name'] == templateName) {
				$scope.template = template;
			}
			if (template['name'] == templateName) {
				$scope.template = template;
				if (template.initializeFunction) {
					template.initializeFunction($scope, $http);
				}
			}
		});

		//initialize();
	}
	angular.module('myApp').controller('searchmodule', searchmodule);
	function searchmodule($scope, $http) {
		initMap();
	}
	angular.module('myApp').controller('profilemodule', profilemodule);
	function profilemodule($scope, $http) {

	}
	angular.module('myApp').controller('bookingModule',bookingModule);
</script>

<script>
	$(".aNav").click(function() {
		$(".aNav").each(function(val) {
			this.className = "aNav";
		});

		this.className = "aNav active";
	});

	function togglenav(e) {
		$(".bookingnav").each(function(val) {
			this.className = "bookingnav";
		});

		e.className = "bookingnav active";
	}
</script>



<script>
	function toggle(e) {
		$("#navMenus").toggle();
	}

	$(function() {
		$('#tabs a:last').tab('show');
	});
</script>
<script>
	function initMap() {

		var width = document.getElementById('mapContent').offsetWidth;
		var height = document.getElementById('mapContent').offsetHeight;
		$("#map").width(width).height(height);

		var mapDiv = document.getElementById('map');
		var map = new google.maps.Map(mapDiv, {
			center : {
				lat : 37.3352,
				lng : -121.8811
			},
			zoom : 10
		});
	}

	function geolocate() {
		autocomplete = new google.maps.places.Autocomplete((document
				.getElementsByClassName('locationservice')[0]), {
			types : [ 'geocode' ]
		});

		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function(position) {
				var geolocation = {
					lat : position.coords.latitude,
					lng : position.coords.longitude
				};
				var circle = new google.maps.Circle({
					center : geolocation,
					radius : position.coords.accuracy
				});
				autocomplete.setBounds(circle.getBounds());
			});
		}
	}
</script>

<script>
angular.module('myApp').controller('detailsModule',detailsModule);
	function detailsModule($scope, $http) {

		$scope.detailtemplates = [ {
			name : 'Availability',
			url : '/availability'
		}, {
			name : 'Images',
			url : '/images'
		}, {
			name : 'reviews',
			url : '/review'
		}, {
			name : 'Payment',
			url : '/payment'
		},
		   {
			name : 'AvailabilityChart',
			url : '/availabilitychart'
		}];

		$scope.details = $scope.detailtemplates[0];
		$scope.availability = function() {
			$scope.details = $scope.detailtemplates[0];
		};

		$scope.images = function() {
			$scope.details = $scope.detailtemplates[1];
		};

		$scope.reviews = function() {
			$scope.details = $scope.detailtemplates[2];
		};

		$scope.payment = function() {
			$scope.details = $scope.detailtemplates[3];
		};
		
		$scope.availabilitychart = function() {
			$scope.details = $scope.detailtemplates[4];
		};
		
		$('#carouselHacked').carousel();
	}
</script>

<script>
angular.module('myApp').controller('reviewController',reviewController);
function reviewController($scope,$http,$location){
	var spotid=1;
	var userid=1;
	var reviewadded=false;
	
	$scope.init = function() {
		loadChartValues();
		loadReviews();
		
	};

	$scope.submit= function() {
		console.log($scope.newRating);
		console.log($scope.newReview);
		if($scope.newRating!= null && $scope.newReview!=null){
			$http({
	            method: 'POST',
	            url: '/savereview',
	            data: { "spotid": spotid, "review":$scope.newReview,"rating":$scope.newRating,"userid" : userid }
	         }).success(function(response){
	        	 var resp= JSON.parse(JSON.stringify(response));
		         document.getElementById("reviewresult").innerHTML=resp;
		         $('#reviewbody').hide();
		         console.log(resp);
		         reviewadded=true;
		    }).error(function(error){
		    	document.getElementById("reviewresult").innerHTML="Adding review failed";
	        });
		}
	};
	
	$scope.reloadData= function() {
		if(reviewadded)
			window.location.reload();
	};
	
	function loadReviews(){
		$http({
            method: 'GET',
            url: '/getallreviews?spotid='+spotid
        }).success(function(response){
        	 var resp= JSON.parse(JSON.stringify(response));
	         $scope.reviews=resp.reviews; 
	         console.log($scope.reviews);
	    }).error(function(error){
        	 alert(error);
        });
	}
	
	function loadChartValues(){
		$http({
            method: 'GET',
            url: '/getreviewschart?spotid='+spotid
         }).success(function(response){
        	 console.log(JSON.stringify(response));
        	 var json = JSON.stringify(response);
        	 var chartVal=$.map( response, function( obj,i){
        	        return [[ "Rating "+ obj.rating, obj.ratingcnt]];                            
        	})
        	  console.log(chartVal);
	          createChart(chartVal);
         }).error(function(error){
        	 alert(error);
    	});
	}
	
	function createChart(chartVal){
		$(function () {
			  Highcharts.setOptions({
				     colors: ['#cc0000', '#ff6600', '#ffcc00', '#99cc00', '#006600']
				    });
			 $('#chart').highcharts({
		            chart: {
		                plotBackgroundColor: null,
		                plotBorderWidth: null,
		                plotShadow: false,
		                type: 'pie',
		                options3d: {
		                    enabled: true,
		                    alpha: 20,
		                    beta:3
		                    
		                   
		                }
		                
		            },
		            credits: {
		                enabled: false
		             },
		            title: {
		                text: null
		            },
		            subtitle: {
		            	text: null
		            },
		            tooltip: {
		                pointFormat: '{series.name}: {point.y}, <b>{point.percentage:.1f}%</b>'
		            },
		            plotOptions: {
		            	 pie: {
		                     allowPointSelect: true,
		                     cursor: 'pointer',
		                     innerSize: 100,
		                     depth: 45,
		                     dataLabels: {
		                    	 enabled: false
		                     },
		                     showInLegend: true
		                 }
		            },
		            series: [{
		                name: 'Ratings',
		                colorByPoint: true,
		                data: chartVal
		            }]
		        });
		});
		
	} 
	
	
}
</script>

<script>
    angular.module('myApp').controller('availabilityController',availabilityController);
	function availabilityController($scope,$http,$location){
		var spotid=1;
		var count1=0,
		count2=0,
		count3=0,
		count4=0
		count5=0,
		count6=0,
		count7=0;
		
		
		$scope.initAvailabilityChart = function() {
			loadChartValues();
		};
		
		function loadChartValues(){
			$http({
	            method: 'GET',
	            url: '/loadavailabilitychart?spotid='+spotid
	        }).success(function(response){
	        	 console.log(JSON.stringify(response));
	        	$.map( response, function( obj,i){
	        		console.log(obj.startday);
	     	        if(obj.startday==="Sunday") 
	     	        	count1=count1+1;
	     	        else if(obj.startday==="Monday")
	     	        	count2=count2+1;
	     	        else if(obj.startday==="Tuesday")
	     	        	count3=count3+1;
	     	       	else if(obj.startday==="Wednesday")
	     	       		count4=count4+1;
	     	       	else if(obj.startday==="Thursday")
	     	       		count5=count5+1;
	     	       	else if(obj.startday==="Friday")
	     	       		count6=count6+1;
	     	       	else if(obj.startday==="Saturday")
	     	       		count7=count7+1;	
	     		})
	     		var chartVal=[count1,count2,count3,count4,count5,count6,count7];
	        	  console.log(chartVal);
		          createChart(chartVal);
	         }).error(function(error){
	        	 alert(error);
	    	});
		}
		
		function createChart(chartVal){
			$(function () {
				 $('#container').highcharts({
				        chart: {
				            type: 'column',
				            options3d: {
				                enabled: true
				               
				            }
				        },
				        title: {
				            text: 'Space Availability'
				        },
				        credits:{
				        	enabled:false
				        },
				        subtitle: {
				            text: null
				        },
				        plotOptions: {
				            column: {
				                depth: 25,
				                pointWidth:50
				            }
				        },
				        xAxis: {
				            categories: Highcharts.getOptions().lang.weekdays  
				        },
				        yAxis: {
				        	allowDecimals:false,
				            title: {
				                text: null
				            }
				        },
				        series: [{
				            name: 'Reservations',
				            data: chartVal
				        }]
				    });

			});
		} 
	}

</script>

<script>
	function opennewwindow(v) {
		localStorage.setItem("imageurl", v);
		var win = window.open('/panaroma',
				'ParkWiz');
		if (win) {
			//Browser has allowed it to be opened
			win.focus();
		} else {
			//Broswer has blocked it
			alert('Please allow popups for this site');
		}
	}
</script>

</html>
