<!DOCTYPE html>
<html lang="en" ng-app>

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>ParkWiz</title>

<script async defer
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjFNJakTcBDyGbyNZHQNSpamaxlpWl3c0&libraries=places">
	
</script>

<!-- Bootstrap Core CSS -->
<link href="/stylesheets/bootstrap.min.css" rel="stylesheet">

<!-- Angular Core javascript -->
<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>


<script src="/js/MyAccount.js"></script>
<script src="/js/booking.js"></script>


<!--Gauge graph-->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>

<script src="https://code.highcharts.com/modules/solid-gauge.js"></script>

<!-- MetisMenu CSS -->
<link href="/stylesheets/metisMenu.min.css" rel="stylesheet">

<!-- Timeline CSS -->
<link href="/stylesheets/timeline.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="/stylesheets/sb-admin-2.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="/stylesheets/font-awesome.min.css" rel="stylesheet"
	type="text/css">

<!-- Profile CSS -->
<link href="/stylesheets/profile.css" rel="stylesheet">

<link media="all" type="text/css" rel="stylesheet"
	href="/stylesheets/myaccount.css">
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body ng-controller="layoutmodule">
	<div id="wrapper">
		<!-- Navigation -->
		<nav class="navbar navbar-default navbar-static-top" role="navigation"
			style="margin-bottom: 0; position: fixed; width: 100%;">
			<table id="navtable" width="100%">
				<tr>
					<td><div class="navbar-header" style="display: block;">
							<div class="dropdown" style="float: left;">
								<button class="dropbtn" onclick="toggle(this);">
									<i class="fa fa-home fa-fw menuSize"></i>Menu
								</button>
								<div id="navMenus" class="dropdown-content" style="left: 0;">
									<ul class="nav" id="side-menu">
										<li><a class="aNav" href="/"><p align="center">
													<i class="fa fa fa-bookmark fa-fw menuSize"></i>
												</p>
												<p align="center">Reservation</p></a></li>
										<li><a class="aNav" href="#"><p align="center">
													<i class="fa fa-child fa-fw menuSize"></i>
												</p>
												<p align="center">User Details</p></a></li>
										<li ng-click="billing();"><a class="aNav" href="#"><p
													align="center">
													<i class="fa fa-money fa-fw menuSize"></i>
												</p>
												<p align="center">Billing</p></a></li>
										<li><a class="aNav" href="#"><p align="center">
													<i class="fa fa-dashboard fa-fw menuSize"></i>
												</p>
												<p align="center">Graphs</p></a></li>
										<li ng-click="details();"><a class="aNav" href="#"><p align="center">
													<i class="fa fa-book fa-fw menuSize"></i>
												</p>
												<p align="center">Reviews</p></a></li>
										<li><a class="aNav" href="#"><p
													align="center">
													<i class="fa fa-sitemap fa-fw menuSize"></i>
												</p>
												<p align="center">Multi-Level</p> </span></a></li>
										<li><a class="aNav" href="#"><p align="center">
													<i class="fa fa-bar-chart-o fa-fw menuSize"></i>
												</p>
												<p align="center">Charts</p></a></li>
									</ul>
								</div>
							</div>
							<a class="navbar-brand" href="/">ParkWiz</a>
						</div> <!-- /.navbar-header --></td>
					<td>
						<div style="float: right;">
							<ul id="subdiv" class="nav navbar-top-links navbar-right">
								<!--<li class="dropdown"><a class="dropdown-toggle"
									data-toggle="dropdown" href="#"> <i
										class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
								</a>
									<ul class="dropdown-menu dropdown-tasks">
										<li><a href="#">
												<div>
													<p>
														<strong>Task 1</strong> <span
															class="pull-right text-muted">40% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-success"
															role="progressbar" aria-valuenow="40" aria-valuemin="0"
															aria-valuemax="100" style="width: 40%">
															<span class="sr-only">40% Complete (success)</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<p>
														<strong>Task 2</strong> <span
															class="pull-right text-muted">20% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-info"
															role="progressbar" aria-valuenow="20" aria-valuemin="0"
															aria-valuemax="100" style="width: 20%">
															<span class="sr-only">20% Complete</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<p>
														<strong>Task 3</strong> <span
															class="pull-right text-muted">60% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-warning"
															role="progressbar" aria-valuenow="60" aria-valuemin="0"
															aria-valuemax="100" style="width: 60%">
															<span class="sr-only">60% Complete (warning)</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<p>
														<strong>Task 4</strong> <span
															class="pull-right text-muted">80% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-danger"
															role="progressbar" aria-valuenow="80" aria-valuemin="0"
															aria-valuemax="100" style="width: 80%">
															<span class="sr-only">80% Complete (danger)</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a class="text-center" href="#"> <strong>See
													All Tasks</strong> <i class="fa fa-angle-right"></i>
										</a></li>
									</ul></li> -->
								<!-- /.dropdown -->
								<!--<li class="dropdown"><a class="dropdown-toggle"
									data-toggle="dropdown" href="#"> <i
										class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
								</a>
									<ul class="dropdown-menu dropdown-alerts">
										<li><a href="#">
												<div>
													<i class="fa fa-comment fa-fw"></i> New Comment <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-twitter fa-fw"></i> 3 New Followers <span
														class="pull-right text-muted small">12 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-envelope fa-fw"></i> Message Sent <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-tasks fa-fw"></i> New Task <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-upload fa-fw"></i> Server Rebooted <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a class="text-center" href="#"> <strong>See
													All Alerts</strong> <i class="fa fa-angle-right"></i>
										</a></li>
									</ul></li> -->
								<!-- /.dropdown -->
								<li class="dropdown"><a class="dropdown-toggle"
									data-toggle="dropdown" href="#"> <i
										class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
								</a>
									<ul class="dropdown-menu dropdown-user">
										<li id="myaccount" ng-click="account();"><a href="#"><i
												class="fa fa-user fa-fw"></i> My Account</a></li>
										<li class="divider"></li>
										<li id="bookinghistory" ng-click="bookinghistory();"><a
											href="#"><i class="fa fa-calendar fa-fw"></i> Booking
												History</a></li>
										<li class="divider"></li>
										<li><a href="#"><i class="fa fa-gear fa-fw"></i>
												Settings</a></li>
										<li class="divider"></li>
										<li><a href="login.html"><i
												class="fa fa-sign-out fa-fw"></i> Logout</a></li>
									</ul> <!-- /.dropdown-user --></li>
								<!-- /.dropdown -->
							</ul>
							<!-- /.navbar-top-links -->
						</div>
					</td>
				</tr>
			</table>



		</nav>

		<div id="page-wrapper">
			<div ng-include src="template.url"></div>
			<br />
		</div>
		<!-- /#page-wrapper -->

	</div>
	<!-- /#wrapper -->

	<!-- Bootstrap Core JavaScript -->
	<script src="/js/bootstrap.min.js"></script>

	<!-- Metis Menu Plugin JavaScript -->
	<script src="/js/metisMenu.min.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="/js/sb-admin-2.js"></script>


</body>

<script>
var autocomplete;
var searchdata;
var privateParkingList;

	function layoutmodule($scope, $http) {
		var templateName = "Search Page"; // Search is the default url.
		if (typeof (Storage) !== "undefined") {
			templateName = sessionStorage.getItem("template");
			if (!templateName) {
				templateName = "Search Page";
			} else {
				sessionStorage.removeItem("template");
			}
		}

		$scope.addlistings = function() {
			$scope.template = $scope.templates[5];
			$("#navMenus").hide();
		};

		$scope.details = function() {
			$scope.template = $scope.templates[6];
			$("#navMenus").hide();
		}

		$scope.billing = function() {
			$scope.template = $scope.templates[1];
			$("#navMenus").hide();
		};

		$scope.bookinghistory = function() {
			$scope.template = $scope.templates[4];
			$("#navMenus").hide();
		};

		$scope.account = function() {
			$scope.template = $scope.templates[3];
			initializeMyAccount($scope, $http);

			$("#navMenus").hide();
		};

		$scope.templates = [ {
			name : 'Search Page',
			url : '/search',
			initializeFunction : undefined
		}, {
			name : 'My Billing History',
			url : '/billing',
			initializeFunction : undefined
		}, {
			name : 'Billing',
			url : '/payment'
		}, {
			name : 'My Account',
			url : '/profile',
			initializeFunction : initializeMyAccount
		}, {
			name : 'My Booking History',
			url : '/bookings',
			initializeFunction : function($scope, $http) {
				$scope.bookingInfo = [ {
					'location' : 'blah st, San Jose, Ca',
					'from' : '01/01/2016',
					'to' : '01/03/2016',
					'status' : 'Completed'
				}, {
					'location' : 'blah st, San Jose, Ca',
					'from' : '02/01/2016',
					'to' : '02/03/2016',
					'status' : 'Pending'
				}, {
					'location' : 'blah st, San Jose, Ca',
					'from' : '04/01/2015',
					'to' : '04/03/2015',
					'status' : 'Completed'
				} ];
			}
		}, {
			name : 'AddListing',
			url : '/addlisting'
		}, {
			name : 'Details',
			url : '/details'
		} ];

		$scope.templates.forEach(function(template) {
			if (template['name'] == templateName) {
				$scope.template = template;
			}
			if (template['name'] == templateName) {
				$scope.template = template;
				if (template.initializeFunction) {
					template.initializeFunction($scope, $http);
				}
			}
		});

		//initialize();
	}
	
function searchmodule($scope, $http) {
		
		initMap();
		$scope.searchParking = function(){
			  
			searchParkings();
			
			setTimeout(function(){
				var data = getParkingList();
				//$scope.privateparkingresult = getParkingList();
				var privateparkingresult = JSON.parse(data);
				//alert(data[0].state);
				//console.log(JSON.stringify(data));
				
				var htmlval = "";
				
				for(var i=0; i<privateparkingresult.length; i++){
					htmlval += '<tr>';
					htmlval += '<td style="width: 20%"><div align="center" class="image">';
					htmlval += '<img style="width: 30%; height: 30%;"';
					htmlval += 'src="https://static.yourparkingspace.co.uk/8963d0b7ecca07ef6fd89760ee6378e3.jpeg"';
					htmlval += 'alt="Parking on 84 N 7th Street, "></div></td>';
					htmlval += '<td style="width: 60%"><div align="center">'+privateparkingresult[i].addressline1+'</div></td>';
					htmlval += '<td><div align="center"><a href="/details" class="bookingnav" >Details</a>';
					htmlval += '</div></td><td><div align="center">';
					htmlval += '<button type="button" class="btn btn-success" ng-click="reserveParking('+privateparkingresult[i].spot_id+')">Reserve</button>';
					htmlval += '</div></td></tr>';
				}
				
				$("#tbodyTabularview").append(htmlval);
				//alert("data "+data);
			},1000);
			
		};
		
		
		$scope.reserveParking = function(spotid){
			alert("Here"+spotid);
			var userid=1;
			console.log("... "+$scope.startdate);
			searchdata = {"startdate": $scope.startdate};
			console.log("... "+searchdata.startdate);
			reserveParkingSpot(userid,spotid,searchdata);
		};
	}

function profilemodule($scope, $http) {
	$(".progress-bar").animate({
		width : "70%"
	}, 2500);
}
</script>

<script>
	$(".aNav").click(function() {
		$(".aNav").each(function(val) {
			this.className = "aNav";
		});

		this.className = "aNav active";
	});

	function togglenav(e) {
		$(".bookingnav").each(function(val) {
			this.className = "bookingnav";
		});

		e.className = "bookingnav active";
	}
</script>



<script>
	function toggle(e) {
		$("#navMenus").toggle();
	}

	$(function() {
		$('#tabs a:last').tab('show');
	});
</script>
<script>
	var map;
	var infowindow;
	var locations;
	function initMap() {	
		var width = document.getElementById('mapContent').offsetWidth;
		var height = document.getElementById('mapContent').offsetHeight;
		$("#map").width(width).height(height);
		
		var mapDiv = document.getElementById('map');
		map = new google.maps.Map(mapDiv, {
			center : {
				lat : 44.540,
				lng : -78.546
			},
			zoom : 15
		});
	}
 	function callback(results, status) {
		if (status === google.maps.places.PlacesServiceStatus.OK) {
			for (var i = 0; i < results.length; i++) {
	            createMarker(results[i]);
			}
		}
	}

	function createMarker(place) {
	    var placeLoc = place.geometry.location;
	    var marker = new google.maps.Marker({
	      map: map,
	      animation: google.maps.Animation.DROP,
	      position: place.geometry.location
	    });
	
	    google.maps.event.addListener(marker, 'click', function() {
	      infowindow.setContent(place.name);
	      infowindow.open(map, this);
	    });
	  }

	function searchParkings(){
	  //alert("Looking for place: " +document.getElementById('txtAddress').value);
	  var geocoder = new google.maps.Geocoder();
	  var address = document.getElementById('txtAddress').value;
	  var latitude = 44.540, longitude = -78.546;
	  
	  //to convert the destination address into lat long values
	  geocoder.geocode( { 'address': address}, function(results, status) {
	    if (status == google.maps.GeocoderStatus.OK) {
	      latitude = results[0].geometry.location.lat();
	      longitude = results[0].geometry.location.lng();
	      //alert(latitude);
	      progressWithLatLong(latitude, longitude);
	    } 
	  });
  }
	
	function progressWithLatLong(latitude, longitude){

		  //alert(map.getCenter());
		  map.setCenter(new google.maps.LatLng(latitude,longitude));
		  
		  var pyrmont = {lat: latitude, lng: longitude};
		  
		  infowindow = new google.maps.InfoWindow();
	        var service = new google.maps.places.PlacesService(map);
	        service.nearbySearch({
	          location: pyrmont,
	          radius: 1000,
	          type: ['parking']
	        }, callback);
	        
	        createDestinationMarker(latitude,longitude);
	        getPrivateParking(latitude,longitude);
	}
	
	function createDestinationMarker(latitude,longitude){
		var MARKER_PATH = 'https://maps.gstatic.com/intl/en_us/mapfiles/marker_yellow';
		var markerIcon = MARKER_PATH + 'D' + '.png';
		var marker = new google.maps.Marker({
	        map: map,
	        position: {lat: latitude, lng: longitude},
	        title: document.getElementById('txtAddress').value,
	        animation: google.maps.Animation.DROP,
	        icon: markerIcon
	        });
	        marker.addListener('click', function(){
	          infowindow.open(map,this);
	          infowindow.setContent(this.title);
		});
	}
	
	function getPrivateParking(latitude,longitude){
		var latlongvalues = [];
		$.ajax({
            type: 'GET',
            url: '/privateParking',
            data: { "latitude": latitude, "longitude": longitude }
         }).success(function(response){
			//alert("success");
       	 	latlongvalues.push(JSON.stringify(response));
       		var privateparkingjson = {'locations': latlongvalues[0]};
       		setParkingList(privateparkingjson)
       		plotPins(privateparkingjson);
       		//alert("FINISH");
         }).error(function(error){
        	 alert("error");
        });
	}
	
	function getParkingList(){
		return privateParkingList;
	}
	
	function setParkingList(privateparkingjson){
		privateParkingList = privateparkingjson.locations;
		//alert("getting parking" +privateParkingList);
		//alert("privateParkingList: "+privateParkingList);
	}
	
function plotPins(privateparkingjson){
	var MARKER_PATH = 'https://maps.gstatic.com/intl/en_us/mapfiles/marker_green';
	var privateparking = privateparkingjson;
	var locations = JSON.parse(privateparking.locations);
		
	for(var i=0; i<locations.length; i++)
	{
		var address2 = locations[i].addressline2 == null ? '' : locations[i].addressline2;
		var addr = locations[i].addressline1+' '+address2;
		var lat = parseFloat(locations[i].latitude);
		var lng = parseFloat(locations[i].longitude);
		var markerLetter = String.fromCharCode('A'.charCodeAt(0) + i);
		var markerIcon = MARKER_PATH + markerLetter + '.png';
		var marker = new google.maps.Marker({
	        map: map,
	        position: {lat: lat, lng: lng},
	        title: addr,
	        animation: google.maps.Animation.DROP,
	        icon: markerIcon
	        });
	        marker.addListener('click', function(){
	        	var htmlText = document.createElement("html");
	        	htmlText.innerHTML = 
				"<head><link href='/stylesheets/bootstrap.min.css' rel='stylesheet'/><link rel='stylesheet' href='style.css'/></head><body style='background-color: #fff!important;'><h5>"
				+this.title+
				"</h5><button align='center' type='button' class='btn btn-success'>Reserve</button><body>";
	          infowindow.open(map,this);
	          infowindow.setContent(htmlText);
		});
	}
	}

	function geolocate() {		
		autocomplete = new google.maps.places.Autocomplete((document.getElementsByClassName('locationservice')[0]), {
			types : [ 'geocode' ]
		});
		
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function(position) {
				var geolocation = {
					lat : position.coords.latitude,
					lng : position.coords.longitude
				};
				var circle = new google.maps.Circle({
					center : geolocation,
					radius : position.coords.accuracy
				});
				autocomplete.setBounds(circle.getBounds());
			});
		}
	}
	
	function reserveParkingSpot(userid,spotid){
		alert("searchdata.... "+searchdata);
		validatePaymentInfo(userid,spotid);
	}
	
	function validatePaymentInfo(userid,spotid){
		$.ajax({
            type: 'GET',
            url: '/checkPaymentInfo',
            data: { "userid": userid , "spotid": spotid}
         }).success(function(response){
        	 if(response){
        		 createReservation();
        	 }else{
        		createReservation();
        		//location.href="/payment";		 
        	 }
			alert("success");
         }).error(function(error){
        	 alert("error");
        });
	}
	
	function createReservation(){
		console.log("inside create reservation"+searchdata.startdate);
		/* $.ajax({
            type: 'GET',
            url: '/createReservation',
            data: { "userid": userid , "spotid": spotid}
         }).success(function(response){
        	 if(response){
        		 createReservation();
        	 }else{
        		createReservation();
        		//location.href="/payment";		 
        	 }
			alert("success");
         }).error(function(error){
        	 alert("error");
        }); */
	}
</script>

<script>
	function detailsModule($scope, $http) {

		$scope.detailtemplates = [ {
			name : 'Availability',
			url : '/availability'
		}, {
			name : 'Images',
			url : '/images'
		}, {
			name : 'reviews',
			url : '/reviews'
		}, {
			name : 'Payment',
			url : '/payment'
		} ];

		$scope.details = $scope.detailtemplates[0];
		$scope.availability = function() {
			$scope.details = $scope.detailtemplates[0];
		};

		$scope.images = function() {
			$scope.details = $scope.detailtemplates[1];
		};

		$scope.reviews = function() {
			$scope.details = $scope.detailtemplates[2];
		};

		$scope.payment = function() {
			$scope.details = $scope.detailtemplates[3];
		};
		
		$('#carouselHacked').carousel();
	}
</script>

<script>
	function opennewwindow(v) {
		localStorage.setItem("imageurl", v);
		var win = window.open('/panaroma',
				'ParkWiz');
		if (win) {
			//Browser has allowed it to be opened
			win.focus();
		} else {
			//Broswer has blocked it
			alert('Please allow popups for this site');
		}
	}
</script>

</html>
